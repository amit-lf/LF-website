

<!doctype html>
<html lang="en">
  
     <head>
     <meta charset="utf-8">
     <meta name="viewport" content="width=device-width, initial-scale=1">
           <link rel="icon" type="image/png" href="/favicon.ico">
     <title>Legal Forencis - Login</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-LN+7fdVzj6u52u30Kp6M/trliBMCMKTyK833zpbD+pXdCLuTusPj697FH4R/5mcr" crossorigin="anonymous">
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/js/bootstrap.bundle.min.js" integrity="sha384-ndDqU0Gzau9qJ1lfW4pNLlhNTkCfHzAVBReH9diLvGRem5+R9g2FzA8ZGN954O5Q" crossorigin="anonymous"></script>

<link href="../styles/custom.css" rel="stylesheet">
 <link rel="shortcut icon" href="../../images/favicon.png" type="image/x-icon">

  </head>
  <body>
            
        
<div class="container">
   <header class="d-flex flex-wrap align-items-center justify-content-center justify-content-md-between py-3 mb-4 ">
    
      <div class="col-md-3 mb-2 mb-md-0"> <a href="../index.html" class="d-flex align-items-center mb-3 mb-md-0 me-md-auto link-body-emphasis text-decoration-none"><img  src="../assets/images/logo/Logo.png" /></a> </div>
      
      <div class="col-md-3 text-end"><a href="register.html"  class="btn btn-primary">Register</a> </div>

  </header>
</div>

<div class="col-lg-3 col-sm-6 mx-auto">

           <div class="px-4 pt-5 my-5 border">


                    <div class="container px-5"> 
                                <form id="loginForm" class="needs-validation" novalidate>
                                                  <h5>Login</h5>
                                         <div class="form-group">
                            
                                            <label for="validationEmail">Email address</label>
                                      
                                            <input type="email" class="form-control" id="validationEmail" aria-describedby="emailHelp" placeholder="Enter your email" required>
                                          
                                               <div class="invalid-feedback">
                                               Invalid Email address.
                                          </div>

                                          </div>
                                                    
                                    
                                       <br/>
                                       <div class="d-grid gap-2">
                                        <button type="submit" class="btn btn-primary">Submit</button>
                                        </div>
                                </form>
                                <br/>
                                <br/>
                    </div>

        </div> 
</div>  
  
<div class="px-4 pt-5 my-5 text-center border-top">

  <span> Â© 2025 Legal Forensics. All Rights Reserved</span>

</div>


  </body>


<script>
// Enhanced logging system for login page
const LOG_LEVELS = { DEBUG: 0, INFO: 1, WARN: 2, ERROR: 3 };
const CURRENT_LOG_LEVEL = LOG_LEVELS.INFO;

function log(level, message, data = null) {
  if (level >= CURRENT_LOG_LEVEL) {
    const timestamp = new Date().toISOString();
    const levelName = Object.keys(LOG_LEVELS)[level];
    console.log(`[${timestamp}] [${levelName}] ${message}`, data || '');
  }
}

// Security: Basic input validation
function validateEmail(email) {
  const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
  return emailRegex.test(email) && email.length <= 254;
}

// Security: Rate limiting for login attempts
let loginAttempts = 0;
const MAX_LOGIN_ATTEMPTS = 5;
const LOCKOUT_TIME = 15 * 60 * 1000; // 15 minutes
let lockoutUntil = 0;

// Enhanced login functionality with security and logging
document.addEventListener('DOMContentLoaded', function() {
  log(LOG_LEVELS.INFO, 'Login page initialized', { 
    userAgent: navigator.userAgent,
    timestamp: new Date().toISOString()
  });
  
  const loginForm = document.getElementById('loginForm');
  
  loginForm.addEventListener('submit', async function(event) {
    event.preventDefault();
    
    // Security: Check for lockout
    if (Date.now() < lockoutUntil) {
      const remainingTime = Math.ceil((lockoutUntil - Date.now()) / 1000 / 60);
      log(LOG_LEVELS.WARN, 'Login attempt blocked - account locked', { remainingMinutes: remainingTime });
      alert(`Too many failed attempts. Please try again in ${remainingTime} minutes.`);
      return;
    }
    
    const email = document.getElementById('validationEmail').value.trim();
    
    log(LOG_LEVELS.INFO, 'Login attempt started', { email: email.substring(0, 10) + '***' });
    
    // Security: Input validation
    if (!email) {
      log(LOG_LEVELS.WARN, 'Login attempt failed - empty email');
      alert('Please enter your email address');
      return;
    }
    
    if (!validateEmail(email)) {
      log(LOG_LEVELS.WARN, 'Login attempt failed - invalid email format', { email: email.substring(0, 10) + '***' });
      alert('Please enter a valid email address');
      return;
    }
    
    try {
      log(LOG_LEVELS.INFO, 'Fetching users from API');
      
      // Get all users from the API
      const startTime = Date.now();
                                                           const response = await fetch('https://legal-forensics-api-dev-vish.hebbarvcorning.workers.dev/api/users');
      const responseTime = Date.now() - startTime;
      
      log(LOG_LEVELS.INFO, 'API response received', { 
        status: response.status, 
        responseTime: `${responseTime}ms` 
      });
      
      if (!response.ok) {
        throw new Error(`API error: ${response.status}`);
      }
      
      const data = await response.json();
      const users = data.users || [];
      
      log(LOG_LEVELS.INFO, 'Users data retrieved', { userCount: users.length });
      
      // Find user with matching email
      const user = users.find(u => u.email.toLowerCase() === email.toLowerCase());
      
      if (user) {
        // Security: Reset login attempts on successful login
        loginAttempts = 0;
        
        log(LOG_LEVELS.INFO, 'User authentication successful', { 
          email: email.substring(0, 10) + '***',
          firstName: user.firstName.substring(0, 1) + '***',
          lastName: user.lastName.substring(0, 1) + '***'
        });
        
        // Store user data securely
        sessionStorage.setItem('userData', JSON.stringify({
          firstName: user.firstName,
          lastName: user.lastName,
          email: user.email,
          loginTime: new Date().toISOString()
        }));
        
        log(LOG_LEVELS.INFO, 'User data stored in session, redirecting to welcome page');
        window.location.href = 'welcome.html';
        
      } else {
        // Security: Increment failed login attempts
        loginAttempts++;
        log(LOG_LEVELS.WARN, 'Login attempt failed - user not found', { 
          email: email.substring(0, 10) + '***',
          failedAttempts: loginAttempts 
        });
        
        if (loginAttempts >= MAX_LOGIN_ATTEMPTS) {
          lockoutUntil = Date.now() + LOCKOUT_TIME;
          log(LOG_LEVELS.WARN, 'Account locked due to too many failed attempts', { 
            lockoutUntil: new Date(lockoutUntil).toISOString() 
          });
          alert('Too many failed attempts. Please try again in 15 minutes.');
        } else {
          alert('No account found with this email address. Please register first.');
        }
      }
      
    } catch (error) {
      loginAttempts++;
      log(LOG_LEVELS.ERROR, 'Login error', { 
        error: error.message,
        stack: error.stack,
        email: email.substring(0, 10) + '***',
        failedAttempts: loginAttempts
      });
      
      if (loginAttempts >= MAX_LOGIN_ATTEMPTS) {
        lockoutUntil = Date.now() + LOCKOUT_TIME;
        alert('Too many failed attempts. Please try again in 15 minutes.');
      } else {
        alert('Login failed. Please try again.');
      }
    }
  });
  
  // Global error handling
  window.addEventListener('error', function(e) {
    log(LOG_LEVELS.ERROR, 'JavaScript error', { 
      message: e.message,
      filename: e.filename,
      lineno: e.lineno,
      colno: e.colno,
      stack: e.error?.stack
    });
  });
  
  window.addEventListener('unhandledrejection', function(e) {
    log(LOG_LEVELS.ERROR, 'Unhandled promise rejection', { 
      reason: e.reason,
      stack: e.reason?.stack
    });
  });
});

// Bootstrap validation
(() => {
  'use strict'

  const forms = document.querySelectorAll('.needs-validation')

  Array.from(forms).forEach(form => {
    form.addEventListener('submit', event => {
      if (!form.checkValidity()) {
        event.preventDefault()
        event.stopPropagation()
      }

      form.classList.add('was-validated')
    }, false)
  })
})()

</script>




</html>
